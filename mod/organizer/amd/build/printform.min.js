define(["jquery","core/config","core/log"],function(a,b,c){var d=function(){this.iconminus="",this.iconplus=""},e=new d;return e.init=function(d){function f(){var b=a("#print_preview");b.find("th").find("a[name$=_cell]").each(function(){var b=a(this).attr("name"),c=b.split("_")[0],d=e.iconminus.replace("xxx",c+"_thiconminus").replace("yyy",c),f=e.iconplus.replace("xxx",c+"_thiconplus").replace("yyy",c);a(this).parent().append(d).append(f),a("#"+c+"_thiconplus").hide()})}function g(){var b=a("#print_preview");b.find("th").find("a[noprint*=1]").each(function(){var b=a(this).attr("name"),c=b.split("_")[0];a("#"+c+"_thiconminus").trigger("click")})}function h(b){var c,d=a(b.target),e=d.attr("col"),f=d.attr("src");f.indexOf("minus")!=-1?(c=!0,a("#"+e+"_thiconminus").hide(),a("#"+e+"_thiconplus").show(),a("a[name="+e+"_cell]").hide()):(c=!1,a("#"+e+"_thiconplus").hide(),a("#"+e+"_thiconminus").show(),a("a[name="+e+"_cell]").show());var g=d.parent().attr("class").replace("header ",""),h=a("#print_preview");h.find(".cell."+g).each(function(){var b=a(this);c?b.find("*").hide():b.find("*").show()}),i()}function i(){var d="mod_organizer_noprintfields",e="",f="",g="";a("img[id$='_thiconplus']").not(":hidden").each(function(){g=a(this).attr("col"),e+=f+g,f=","});var h={method:"get",url:b.wwwroot+"/lib/ajax/setuserpref.php",data:{sesskey:b.sesskey,pref:encodeURI(d),value:encodeURI(e)},dataType:"json",beforeSend:function(){c.info("set user preference "+d+": "+e,"organizer")},success:function(){c.info("set user preference OK","organizer")},error:function(){c.error("set user preference FAILED","organizer")}};a.ajax(h)}e.iconminus=d.iconminus,e.iconplus=d.iconplus,f();var j=a("#print_preview");j.find("th").find("img[id*=_thicon]").on("click",h),g()},e});