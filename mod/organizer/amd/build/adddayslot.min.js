define(["jquery"],function(a){var b=function(){this.totalslots=0,this.displayallslots=0,this.totalday="",this.totaltotal="",this.current="0"},c=new b;return c.init=function(b){function d(b){var c=a(b.target),d=c.attr("name"),f=parseInt(d.replace("newslots[","")),g=parseInt(a("select[name='newslots["+f+"][from]']").val()),h=parseInt(a("select[name='newslots["+f+"][to]']").val());g>h&&a("select[name='newslots["+f+"][to]']").val(g),e(f),k()}function e(b){var d=g(b),e=i(b);e*=d;var f=j();f*=e;var h=c.totalday.replace("xxx",e.toString()).replace("yyy",f.toString());a("span[name='forecastday_"+b+"']").html(h),a("span[name='newslots_"+b+"']").html(e.toString()),a("span[name='newpax_"+b+"']").html(f.toString())}function f(){for(var a=0;a<c.current;a++)e(a);k()}function g(b){var c=0,d=parseInt(a("select[name^='newslots["+b+"][day]']").val());if(d>=0&&d<=6){var e=d+1;c=h(7==e?0:e)}return c}function h(b){for(var c=0,d=a("select[name='startdate[day]']").val(),e=a("select[name='startdate[month]']").val()-1,f=a("select[name='startdate[year]']").val(),g=new Date(f,e,d),h=a("select[name='enddate[day]']").val(),i=a("select[name='enddate[month]']").val()-1,j=a("select[name='enddate[year]']").val(),k=new Date(j,i,h),m=g;m<=k;m=l(m,1))m.getDay()==b&&c++;return c}function i(b){var c=0,d=parseInt(a("select[name^='newslots["+b+"][from]']").val()),e=parseInt(a("select[name^='newslots["+b+"][to]']").val());if(e<=d)return 0;var f=parseInt(a("input[name='duration[number]']").val()),g=parseInt(a("select[name='duration[timeunit]']").val()),h=parseInt(a("input[name='gap[number]']").val()),i=parseInt(a("select[name='gap[timeunit]']").val());if(isNaN(f))return 0;var j=f*g;isNaN(h)&&(h=0);for(var k=h*i,l=j+k,m=d+l;m<=e;m+=l)c++;return m-k<=e&&c++,c}function j(){var b=a("input[name=maxparticipants]").val();return a.isNumeric(b)?b:0}function k(){var b=0,d=0;a("span[name^='newslots_']").each(function(){var c=parseInt(a(this).html());0==isNaN(c)&&(b+=c)}),a("span[name^='newpax_']").each(function(){var b=parseInt(a(this).html());0==isNaN(b)&&(d+=b)});var e=c.totaltotal.replace("xxx",b.toString()).replace("yyy",d.toString());a("div[name='organizer_newslots_forecasttotal']").html(e)}function l(a,b){return a.setDate(a.getDate()+b),a}if(c.totalslots=b.totalslots,c.displayallslots=b.displayallslots,c.totalday=b.totalday,c.totaltotal=b.totaltotal,0==c.displayallslots){for(var m=c.totalslots-1;m>0&&a("#id_newslots_"+String(m)+"_day").val()==-1;m--)a("#id_newslots_"+String(m)+"_day").closest(".form-group.row.fitem").hide(),a("#fgroup_id_slotgroup"+String(m)).hide();m<c.totalslots-1&&a("#id_addday").hide(),a("[id^=id_newslots_]").change(function(){var b=a(this).attr("id"),d=parseInt(b.split("_")[2])+1;d>c.current&&(a("#id_newslots_"+String(d)+"_day").closest(".form-group.row.fitem").show(),a("#fgroup_id_slotgroup"+String(d)).show(),d==c.totalslots&&a("#id_addday").show(),c.current++)})}a('[name^="newslots"]').not(":checkbox").on("change",d),a('input[name^="duration"]').on("change",f),a('select[name^="duration"]').on("change",f),a('input[name^="gap"]').on("change",f),a('select[name^="gap"]').on("change",f),a('input[name="maxparticipants"]').on("change",f),a('select[name^="startdate"]').on("change",f),a('select[name^="enddate"]').on("change",f),1==a("#id_now").prop("checked")&&(a("[name^=availablefrom]").prop("disabled",!0),a("#id_availablefrom_timeunit").prop("disabled",!0))},c});